
{% extends 'core/base.html'  %}
{% load crispy_forms_tags %}
{% load humanize %}

{% block upperscript%}
<!--<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<link rel="stylesheet" href="https://unpkg.com/bulma@0.9.0/css/bulma.min.css" />
    <script src="https://kit.fontawesome.com/7dc3015a44.js" crossorigin="anonymous"></script>-->
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700" rel="stylesheet">
    <!-- Bulma Version 0.9.0-->
    <link rel="stylesheet" href="https://unpkg.com/bulma@0.9.0/css/bulma.min.css" />



<style>

</style>

{% endblock %}

{% block content %}

<div class="container" id="articleapp">
    <div class="columns">
      <div class="column is-11 is-offset-one">
          <span><a href="{% url 'articles' articles.category.id %}">Go back</a></span>
          <h1 class="title">Read Article</h1>
          <nav class="breadcrumb" aria-label="breadcrumbs">
  <ul>
    <li><a href="{% url 'article_category' %}">Article Home </a></li>
    <li><a href="{% url 'articles' articles.category.id %}">{{articles.category.name}}</a></li>
    <li class="is-active"><a href="#" aria-current="page">{{articles.title}}</a></li>
  </ul>
</nav>

 <section class="hero ">
    <div class="hero-body">
      <div class="container">
        <div class="columns">
          <div class="column is-8 is-offset-2">
            <figure class="image is-16by9">
                {% if articles.titleimage %}
              <img src="{{articles.titleimage.url}}" alt="image">
                {% endif %}
            </figure>
          </div>
        </div>

          <div class="column is-8 is-offset-2">
 <div class="media">
                  <div class="media-right">
                    <figure class="image is-48x48">
                      {% if articles.created_by.studysocioprofile.avatar %}
                <img class="avatar" src="{{ articles.created_by.studysocioprofile.avatar.url }}"  style=" vertical-align: middle;
  border-radius: 50%; height:50px;width:65px;">

                              {% endif %}
                    </figure>
                  </div>
&nbsp;&nbsp;&nbsp;
     <span class="media-content">
                    <p class="title is-5 no-padding">by :&nbsp;{{articles.created_by.first_name}} {{articles.created_by.last_name}}
                          <br> <small>@ <a href="{% url 'studysocioprofile' articles.created_by.username %}">
                          {{articles.created_by.username}} </a> ({{articles.created_by.studysocioprofile.designation}})</small>
                    </p>
         <span class="level-left" >
         <a class="level-item">
             <a @click="likeArticle({{ articles.id }})" v-if="!liked_article.includes({{ articles.id }})">
                 <span class="icon is-small"><i class="fas fa-heart"></i></span></a>
        </a>
         <span v-if="liked_article.includes({{ articles.id }})"><span class="icon is-small"><i class="fas fa-heart" style="color:red;"></i></span></span>
          &nbsp;<span><small id="likes-{{ articles.id }}">{{ articles.article_likes.count }} likes</small> </span></span>
                  </span>
                </div>
              </div>


        <section class="section">
          <div class="columns">
            <div class="column is-8 is-offset-2">
              <div class="content is-medium">

                <h2 class="subtitle is-4">{{articles.created_at}} - <span class="level-right"><i>
                    <small class="subtitle is-6"> Last Updated : {{articles.modified_at|naturaltime}}</small></i></span></h2>
                <h1 class="title">{{articles.title}}</h1>
                <p>{{articles.description}}</p>
                  <br>
                  <br>
                  {{articles.content|safe}}
              </div>
            </div>
          </div>
        </section>

      </div>
    </div>
 </section>

    </div>
    </div>
</div>

{% endblock %}

{% block script %}
 <script>
  new Vue({
    el: '#articleapp',
    delimiters: ['[[',']]'],
    data() {
      return{
        body: '',
        poster: '{{ request.user.username }}',
        created_at: 'Now',
        liked_article:[{% for Likes in Likes %}{% if Likes.created_by == request.user %}{{ articles.id }},{% endif %}{% endfor %}]
      }

    },
    methods: {
      likeArticle(articles_id) {
            this.liked_article.push(parseInt(articles_id))

            var articles = {
            'Article_id': articles_id
            };

      fetch('/api/api_like_article/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}'
                        },
                        credentials: 'same-origin',
                        body: JSON.stringify(articles)
                    })
                    .then((response) => {
                        console.log(response);
                    })
                    .catch((error) => {
                        console.log(error);
                    });

                    const el = document.getElementById('likes-' + articles_id);
                    const likes = parseInt(el.innerHTML.split(' ')[0]) + 1;
                    el.innerHTML = likes + ' likes';
                },
    },


  })
</script>

<script>
    if ( window.history.replaceState ) {
        window.history.replaceState( null, null, window.location.href );
    }
</script>
<script>
    setTimeout(function(){
        if ($('#msg').length > 0) {
            $('#msg').remove();
        }
    }, 3000)    // 3000 millisecond
</script>
{% endblock %}