{% extends 'core/base.html'  %}
{% load humanize %}
{% block upperscript%}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>

<link href="..../dist/emojione.picker.css" rel="stylesheet">
<script src="..../dist/emojione.picker.js"></script>
{% endblock %}

{% block content %}
<div class="container" id="directconversationapp">
    <div class="columns" >
      <div class="column is-12">
          <h1 class="title">Conversation</h1>
          <hr>
          {% for x in  group %}
          <h2 class="heading"><a href="{% url 'listofgroupmembers' x.id %}">{{groupconversationmembers.count}} - Group Members</a></h2>
          {% endfor %}
            <hr>
          <div class="message" id="chat">
              {% for message in groupconversation.all %}
              <div class="postfeed" >
                  <article class="media"  >
                      {% if message.created_by.studysocioprofile.user != request.user.studysocioprofile.user  %}
                      <figure class="media-left">
                          <p class="image is-64x64">
                              {% if message.created_by.studysocioprofile.avatar %}
                                <img src="{{ message.created_by.studysocioprofile.avatar.url }}">
                              {% endif %}
                          </p>
                      </figure>
                      {% endif %}
<br>
                       <div class="media-content">
                          <div class="content">
                              <div {% if message.created_by.studysocioprofile.user == request.user.studysocioprofile.user  %} class="notification is-primary is-light"{% else %} class="notification" {% endif %}>
                              <p>
                                  <strong>@ {{ message.created_by.username }}</strong>
                                  <small>{{ message.created_at|naturaltime }}</small>
                                  <br>
                                  {{ message.content|linebreaks|urlizetrunc:15 }}
                                  <br>
                                  {% if message.image %}
                                    <img src="{{ message.image.url }}" alt="" class="card-img-top" width="400" height="400"align="center">
                                  {% endif %}


                              </p>
                          </div>
                              </div>
                      </div>
                      {% if message.created_by.studysocioprofile.user == request.user.studysocioprofile.user  %}
                      <figure class="media-right">
                          <p class="image is-64x64">
                              {% if message.created_by.studysocioprofile.avatar %}
                                <img src="{{ message.created_by.studysocioprofile.avatar.url }}">
                              {% endif %}
                          </p>
                      </figure>
                      {% endif %}
                                    {% if message.created_by == request.user.studysocioprofile.user %}
<div class="media-right">
                                        <form action="{{message.groupconversation.id }}/delete/{{ message.id }}" method="post">

                                       {% csrf_token %}
                                         <button type="submit" class="delete"></button>
                                        </form>
                                  {% endif %}

  </div>
                  </article>
                  <br><br>
              </div>


              {% endfor %}
             <!--<div class="postfeed" v-for="message in messages">
                 <article class="media" >
                      <figure class="media-left">
                          <p class="image is-64x64">
                                <img :src="message.avatar">
                          </p>

                      </figure>

                       <div class="media-content">
                          <div class="content">
                              <p>
                                  <strong>@ [[ message.users ]]</strong>
                                  <small>[[ message.created_at ]]</small>
                                  <br>
                                  [[ message.content ]]
                                  <br>

<br>
                              </p>
                              <p v-if="message.image">
                                    <br>
                                    <img  :src="[[message.image]]" alt="" class="card-img-top" width="400" height="400"align="center">
                              </p>
                          </div>
                      </div>
                  </article>
             </div>-->
          </div>

      </div>
    </div>

    <hr>

    <form method = "post" v-on:submit.prevent="submitMessage()" enctype="multipart/form-data">
        <div class="field">
            {% csrf_token %}
              <div class="control">
                <textarea class="textarea is-medium" v-model="content" name="content" id="content" placeholder="Your message" ></textarea>
                <!--{{ form.as_p }}-->
                  <br>
                  <div id="file-js-example" class="file has-name">
  <label class="file is-small has-name is-warning ">
    <input class="file-input" type="file" name="image" id="image" accept="image/*"  @change="previewImage">
    <span class="file-cta">
      <span class="file-icon">
        <i class="fas fa-upload"></i>
      </span>
      <span class="file-label">
        Choose a fileâ€¦
      </span>
    </span>
    <span class="file-name">
      No file uploaded
    </span>
  </label>
</div>


              </div>
            </div>
            <div class="field">
              <div class="control">
                <button id="submit"  class="button is-success"  type="submit">Send</button>
              </div>
            </div>
    </form>
</div>
{% endblock %}

{% block script %}
<script>
    function scrollToBottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }
    history.scrollRestoration = "manual";
    window.onload = scrollToBottom;

</script>
     <script>
$(document).ready(function(){
setInterval(function(){
      $("#chat").load(document.URL + " #chat" );
}, 5000);
});
</script>



<script>
$( "textarea" ).emojionePicker({
  pickerTop: 5,
  pickerRight: 5
});
</script>

{% endblock %}