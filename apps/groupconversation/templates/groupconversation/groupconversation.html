{% extends 'core/base.html'  %}
{% load humanize %}
{% block upperscript%}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>


{% endblock %}

{% block content %}


    <div class="column has-background-success" style=" position:absolute ;

    z-index:9;overflow: hidden;
 background: #F5F5F5;
  position: sticky;
  top: 7%;
  width: 100%; padding:8px">


      <div class="column is-12 " >
          {% for x in  group %}
<article class="media">
  <figure class="media-left">
    <p class="image is-64x64">
      {% if x.groupimage %}
      <img style=" vertical-align: middle;
  border-radius: 50%; height:65px;width:90px;" src="{{ x.groupimage.url }}">
        {% endif %}
    </p>
  </figure>
  <div class="media-content">
    <div class="content has-text-white-bis" style="margin-top:1%;">
      <p>
        <B> <span class="content is-large" >{{x.name}}: </span>
        </B><span ><a href="{% url 'listofgroupmembers' x.id %}"> <span class="icon">
    <i class="fas fa-home"></i>
  </span>&ensp;{{groupconversationmembers.count}} - Group Members</a></span>

      </p>
    </div>

  </div>
    {% for x in  group %}
    {% if x.created_by == request.user.studysocioprofile.user %}
    <span class="level-right" style="margin-top:1%;"><a href="{% url 'edit_group' x.id %}"><button class="button is-light is-small ">
    Edit Group
</button> </a></span>&ensp;
<span class="level-right" style="margin-top:1%;"><a href="{% url 'add_members' x.id %}"><button class="button is-light is-small ">
    Add Member
</button> </a></span>
    {% endif %}
    {% endfor %}
</article>

          {% endfor %}
 </div>

 </div>
<br>
<div class="container" id="directconversationapp">

    <div class="columns" >

      <div class="column is-12" >
          <div class="message" id="chat" >
              {% for message in groupconversation.all %}
              <div class="postfeed" >
                  <article class="media"  >
                      {% if message.created_by.studysocioprofile.user != request.user.studysocioprofile.user  %}
                      <figure class="media-left">
                          <p class="image is-64x64">
                              {% if message.created_by.studysocioprofile.avatar %}
                                <img src="{{ message.created_by.studysocioprofile.avatar.url }}">
                              {% endif %}
                          </p>
                      </figure>
                      {% endif %}
<br>
                       <div class="media-content">
                          <div class="content">
                              <div {% if message.created_by.studysocioprofile.user == request.user.studysocioprofile.user  %} class="notification is-primary is-light"{% else %} class="notification" {% endif %}>
                              <p>
                                  <strong>@ {{ message.created_by.username }}</strong>
                                  <small>{{ message.created_at|naturaltime }}</small>
                                  <br>
                                  {{ message.content|linebreaks|urlizetrunc:15 }}
                                  <br>
                                  {% if message.image %}
                                    <img src="{{ message.image.url }}" alt="" class="card-img-top" width="400" height="400"align="center">
                                  {% endif %}


                              </p>
                          </div>
                              </div>
                      </div>
                      {% if message.created_by.studysocioprofile.user == request.user.studysocioprofile.user  %}
                      <figure class="media-right">
                          <p class="image is-64x64">
                              {% if message.created_by.studysocioprofile.avatar %}
                                <img src="{{ message.created_by.studysocioprofile.avatar.url }}">
                              {% endif %}
                          </p>
                      </figure>
                      {% endif %}
                                    {% if message.created_by == request.user.studysocioprofile.user %}
                            <div class="media-left">
                                        <form action="{{message.groupconversation.id }}/delete/{{ message.id }}" method="post">

                                       {% csrf_token %}
                                         <button type="submit" class="delete"></button>
                                        </form>


                            </div>
                      {% endif %}
                  </article>
                  <br>
              </div>


              {% endfor %}

          </div>

      </div>
    </div>

    <hr>
  {% if messages %}
<ul class="messages">
    {% for message in messages %}

    {% if message.tags == 'warning' %}
    <div  class= "notification is-danger" id="msg">
   {{ message }}
    </div>
     {% else %}
    <div  class="notification is-success" id="msg">
     {{ message }}
    </div>
   {% endif %}
    {% endfor %}
</ul>
{% endif %}
    <form method = "post" v-on:submit.prevent="submitMessage()" enctype="multipart/form-data" style=" position:absolute;
padding-bottom:1%;
    z-index:9;overflow: hidden;
 background: #F5F5F5;
  position: sticky;
  bottom:0%;
  width: 100%;">
        <div class="field">
            {% csrf_token %}
              <div class="control">
                <textarea class="textarea is-small " v-model="content" name="content" id="content" placeholder="Your message"  ></textarea>
                <!--{{ form.as_p }}-->
                  <br>
                  <div id="file-js-example" class="file has-name">
  <label class="file is-small has-name is-warning ">
    <input class="file-input" type="file" name="image" id="image" accept="image/*"  @change="previewImage">
    <span class="file-cta">
      <span class="file-icon">
        <i class="fas fa-upload"></i>
      </span>
      <span class="file-label">
        Choose a fileâ€¦
      </span>
    </span>
    <span class="file-name">
      No file uploaded
    </span>
  </label>
</div>


              </div>
            </div>
            <div class="field">
              <div class="control">
                <button id="submit"  class="button is-success"  type="submit">Send</button>
              </div>
            </div>
    </form>

</div>

{% endblock %}

{% block script %}
<script>
    setTimeout(function(){
        if ($('#msg').length > 0) {
            $('#msg').remove();
        }
    }, 4000)    // 3000 millisecond
</script>
<script>
    function scrollToBottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }
    history.scrollRestoration = "manual";
    window.onload = scrollToBottom;

</script>
     <script>
$(document).ready(function(){
setInterval(function(){
      $("#chat").load(document.URL + " #chat" );
}, 5000);
});
</script>



<script>
$( "textarea" ).emojionePicker({
  pickerTop: 5,
  pickerRight: 5
});
</script>

{% endblock %}